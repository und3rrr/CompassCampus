# Product Requirements Document (PRD)
## CampusCompass2 - Campus Navigation System

### Версия: 1.0
### Дата: 24 декабря 2025 г.
### Статус: Product Definition

---

## 1. ОБЗОР ПРОДУКТА

### 1.1 Описание
**CampusCompass2** - это система навигации по университетскому кампусу, которая позволяет пользователям находить кратчайшие маршруты между помещениями (аудиториями, коридорами, лестничными клетками и лифтами) в многоэтажном здании или комплексе зданий.

### 1.2 Целевая аудитория
- Студенты университета
- Преподаватели
- Персонал кампуса
- Посетители

### 1.3 Основная задача
Помочь пользователям быстро и легко найти маршрут между двумя точками на кампусе, учитывая многоуровневую структуру зданий.

---

## 2. КЛЮЧЕВЫЕ ОСОБЕННОСТИ

### 2.1 Основной функционал

#### 2.1.1 Навигация и поиск маршрутов
- **Выбор начальной и конечной точки**: Пользователь может кликнуть на узлы (помещения) для установки начальной (стартовой) и конечной точки маршрута
- **Автоматический расчёт кратчайшего маршрута**: Использует алгоритм Дейкстры для поиска оптимального пути
- **Поддержка многоэтажных зданий**: Система учитывает переходы между этажами через лестницы и лифты
- **Визуализация маршрута**: Выбранный маршрут отображается на экране линией, с анимацией пути
- **Кэширование путей**: Сохранение ранее рассчитанных маршрутов для оптимизации производительности

#### 2.1.2 Система узлов и рёбер
- **Типы узлов (Node Types)**:
  - `Room` - помещение (аудитория, офис)
  - `Corridor` - коридор
  - `Staircase` - лестничная клетка
  - `Elevator` - лифт
  
- **Свойства узлов**:
  - ID (уникальный идентификатор)
  - Name (название)
  - Position (координаты X, Y на плане)
  - Floor (номер этажа)
  - Type (тип узла)
  - CustomSize (размер визуализации)
  - RotationAngle (угол поворота иконки)

- **Рёбра (Edge)**: Связь между двумя узлами с весом (расстояние/стоимость)

#### 2.1.3 Управление картой
- **Создание/редактирование узлов**: Добавление новых помещений и коридоров
- **Установка связей**: Создание рёбер между узлами для определения проходимости
- **Удаление элементов**: Удаление узлов и связанных рёбер
- **Сохранение/загрузка**: Сохранение карты в JSON формате и загрузка при запуске

#### 2.1.4 Планы этажей
- **Загрузка изображений планов**: Поддержка планов этажей как фоновых изображений
- **Масштабирование и позиционирование**: Автоматическое масштабирование изображения для вписания в экран
- **Привязка узлов к планам**: Узлы отображаются поверх изображения плана

### 2.2 Дополнительный функционал

#### 2.2.1 Пользовательский интерфейс
- **Выбор этажа**: Dropdown для переключения между этажами
- **Информационная панель**: Отображение информации о текущей навигации
- **Тёмная тема**: Переключение между светлой и тёмной темой оформления
- **Всплывающие подсказки**: ToolTips при наведении на элементы

#### 2.2.2 Редакторский режим (Edit Mode)
- **Toggle Edit Mode**: Кнопка для входа/выхода из режима редактирования
- **Выделение узлов**: Визуальное выделение выбранного узла
- **Контекстное меню**: Правый клик для доступа к опциям редактирования
- **Цветовое кодирование**: Разные цвета для разных типов узлов

#### 2.2.3 Управление масштабом и панорамой
- **Прокрутка колёсика мыши**: Масштабирование представления
- **Перетаскивание**: Панорамирование карты (drag & drop)
- **Анимация пути**: Движущаяся визуализация маршрута

#### 2.2.4 История действий (Undo/Redo)
- **Stack-based system**: Стек действий для отката и повторения операций
- **Логирование**: Запись всех действий пользователя

#### 2.2.5 Клавиатурные сокращения
- **M**: Переключение режима редактирования
- **V**: Скрытие/показ узлов редактирования
- **D**: Открытие диалога удаления узла
- **L**: Загрузка плана этажа
- **S**: Сохранение карты
- **Ctrl+Z / Ctrl+Y**: Undo/Redo

---

## 3. ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ

### 3.1 Архитектура
- **Модульная структура**: Разделение на компоненты (BuildingMap, Dijkstra, Node, Edge, UI)
- **Слабая связанность**: Компоненты независимы и легко тестируемы
- **JSON-based data storage**: Хранение карты в JSON формате для портативности

### 3.2 Алгоритм маршрутизации
- **Dijkstra's Algorithm**: Поиск кратчайшего пути в взвешенном графе
- **Обработка переходов между этажами**: Специальная логика для лестниц и лифтов
- **Обработка ошибок**: Валидация узлов, проверка связности графа

### 3.3 Данные

#### Формат сохранения (JSON):
```json
{
  "Nodes": [
    {
      "Id": 1,
      "Name": "Аудитория 101",
      "Position": { "X": 100, "Y": 150 },
      "Floor": 1,
      "Type": "Room",
      "CustomSize": 20,
      "RotationAngle": 0.0
    }
  ],
  "Edges": [
    {
      "FromId": 1,
      "ToId": 2,
      "Weight": 25.5
    }
  ],
  "FloorPlans": {
    "1": "path/to/floor1.png",
    "2": "path/to/floor2.png"
  }
}
```

---

## 4. ТРЕБОВАНИЯ К ПРОИЗВОДИТЕЛЬНОСТИ

### 4.1 Пороги производительности
- **Время расчёта маршрута**: < 100 мс для графа с 1000 узлами
- **Время загрузки карты**: < 500 мс
- **Память**: Оптимизация для работы с минимальным использованием RAM
- **Кэширование**: Кэш путей для избежания пересчёта одинаковых маршрутов

### 4.2 Масштабируемость
- Поддержка кампусов с несколькими зданиями
- Поддержка до 100+ этажей (для многоэтажных комплексов)
- Поддержка тысяч узлов

---

## 5. ТЕСТИРОВАНИЕ

### 5.1 Unit-тесты (xUnit framework)
Покрытие включает:
- Расчёт простых путей
- Обработка граничных случаев (тот же узел, отсутствие пути)
- Переходы между этажами
- Сложные графы с циклами
- Производительность на больших графах

### 5.2 Типы тестов
- `Test_RouteCalculation_SimplePath` - проверка простого маршрута
- `Test_RouteCalculation_SameStartAndEndNode` - одинаковые начало и конец
- `Test_RouteCalculation_NoPathExists` - отсутствие маршрута
- `Test_RouteCalculation_DifferentFloorsWithStaircase` - переходы между этажами
- `Test_RouteCalculation_MultiplePaths` - выбор оптимального пути
- `Test_RouteCalculation_LargeGraphPerformance` - тестирование производительности

---

## 6. ИНТЕГРАЦИЯ ДЛЯ НОВЫХ ПЛАТФОРМ

### 6.1 Архитектура для переноса на веб и мобильные приложения

#### Рекомендуемая структура:

```
Backend API (RESTful/GraphQL)
    ├── /api/routes - расчёт маршрутов
    ├── /api/buildings - информация о зданиях
    ├── /api/floors - информация об этажах
    ├── /api/nodes - помещения/узлы
    └── /api/edges - связи между узлами

Core Library (Language-Agnostic)
    ├── Graph Module (Dijkstra implementation)
    ├── Map Module (Building structure)
    ├── Data Models (Node, Edge, Building)
    └── Cache Module (Route caching)

Frontend Applications
    ├── Web (React/Vue/Angular)
    ├── Android (Python/Kotlin)
    └── iOS (Swift/Python)
```

### 6.2 API Endpoints

#### Расчёт маршрута
```
GET /api/routes/shortest
Parameters:
  - startNodeId: int
  - endNodeId: int
  - buildingId: string (optional)
  
Response:
{
  "path": [
    { "id": 1, "name": "Аудитория 101", "floor": 1 },
    { "id": 2, "name": "Коридор A", "floor": 1 },
    { "id": 4, "name": "Лифт 1", "floor": 1 }
  ],
  "totalDistance": 45.5,
  "estimatedTime": "2 минуты",
  "floorTransitions": [1, 2],
  "instructions": ["Выйти из Аудитории 101", "Пройти по коридору A", "Зайти в Лифт 1"]
}
```

#### Получение информации о здании
```
GET /api/buildings/{buildingId}
Response:
{
  "id": "building_001",
  "name": "Главное здание",
  "floors": [1, 2, 3, 4, 5],
  "nodes": [...],
  "floorPlans": {...},
  "center": { "lat": 55.7558, "lon": 37.6173 }
}
```

#### Поиск помещения по названию
```
GET /api/search
Parameters:
  - query: string
  
Response:
{
  "results": [
    { "id": 1, "name": "Аудитория 101", "building": "Main Building", "floor": 1 },
    { "id": 15, "name": "Лаборатория 101", "building": "Lab Building", "floor": 2 }
  ]
}
```

### 6.3 Данные для передачи на новые платформы

#### Минимальный набор данных для мобильного приложения:
```json
{
  "version": "1.0",
  "buildings": [
    {
      "id": "building_001",
      "name": "Main Campus",
      "floors": [1, 2, 3, 4, 5],
      "nodes": [
        {
          "id": 1,
          "name": "Room 101",
          "type": "Room",
          "floor": 1,
          "position": { "x": 100, "y": 150 },
          "description": "Classroom"
        }
      ],
      "edges": [
        { "from": 1, "to": 2, "weight": 25.5 }
      ],
      "floorPlans": {
        "1": "base64_encoded_image_or_url"
      }
    }
  ]
}
```

---

## 7. UI/UX ТРЕБОВАНИЯ

### 7.1 Веб-версия (Website)
- **Responsive Design**: Адаптация под разные размеры экранов
- **Интерактивная карта**: Зум, панорамирование, клик по помещениям
- **Поиск помещений**: Автодополнение для быстрого поиска
- **История маршрутов**: Сохранение недавних маршрутов
- **Мобильный интерфейс**: Оптимизация для мобильных браузеров

### 7.2 Мобильное приложение (Android/iOS)
- **GPS интеграция**: Определение текущего положения пользователя
- **Turn-by-turn навигация**: Пошаговые инструкции
- **Offline mode**: Работа без интернета
- **Сохранение избранных маршрутов**: Закладки часто используемых путей
- **Notifications**: Уведомления о переходе между этажами
- **Voice navigation**: Голосовые подсказки

### 7.3 Дизайн элементов
- **Цветовое кодирование узлов**:
  - Room (Помещение): Синий
  - Corridor (Коридор): Зелёный
  - Staircase (Лестница): Оранжевый
  - Elevator (Лифт): Красный

- **Визуализация пути**: Красная/жёлтая линия с анимацией
- **Стартовая точка**: Зелёный маркер
- **Конечная точка**: Красный маркер

---

## 8. РАСШИРЕНИЯ И УЛУЧШЕНИЯ (Roadmap)

### Phase 1 (MVP)
- [x] Базовая навигация на одном этаже
- [x] Навигация между этажами
- [x] Редактор карты
- [x] Сохранение/загрузка карты

### Phase 2
- [ ] Web interface
- [ ] API backend (REST)
- [ ] Database integration (MongoDB/PostgreSQL)
- [ ] User authentication
- [ ] Search functionality

### Phase 3
- [ ] Android app
- [ ] iOS app
- [ ] GPS integration
- [ ] Voice navigation
- [ ] Offline maps

### Phase 4
- [ ] Indoor positioning (WiFi/Bluetooth)
- [ ] Real-time updates
- [ ] User ratings/reviews
- [ ] Crowd density integration
- [ ] Multi-language support

---

## 9. БЕЗОПАСНОСТЬ И КОНФИДЕНЦИАЛЬНОСТЬ

### 9.1 Требования безопасности
- **Data validation**: Валидация всех входных данных
- **Error handling**: Graceful error handling без утечки информации
- **Authentication**: Для административных функций (когда будет веб-версия)
- **Authorization**: Разделение прав доступа

### 9.2 Конфиденциальность
- Локальное хранение карт на устройстве (для мобильных)
- Шифрование чувствительных данных
- Соответствие GDPR для веб-приложения

---

## 10. АНАЛИТИКА И МОНИТОРИНГ (Для будущих версий)

### 10.1 Метрики
- Количество рассчитанных маршрутов
- Популярные маршруты
- Средняя длина маршрута
- Время отклика API
- Использование различных типов транзита (лифты vs лестницы)

### 10.2 Error tracking
- Ошибки при расчёте маршрутов
- Проблемы с загрузкой карт
- Performance issues

---

## 11. CONSTRAINTS И LIMITATIONS

### 11.1 Текущие ограничения
- Статическая карта (нет real-time обновлений)
- Базовые типы помещений (4 типа)
- Простой визуальный интерфейс (no 3D)
- Локальная работа в Windows Forms

### 11.2 Будущие ограничения для масштабирования
- Максимум помещений на этаже: ~10,000 узлов
- Максимум этажей: ~500 этажей
- Размер базы данных: зависит от количества рёбер

---

## 12. БИЗНЕС-ТРЕБОВАНИЯ

### 12.1 Цель внедрения
- Улучшить навигацию по кампусу
- Сократить время на поиск помещений для новых студентов и посетителей
- Снизить нагрузку на информационную службу

### 12.2 ROI метрики
- Увеличение удовлетворённости студентов
- Снижение количества вопросов в info desk
- Время на ознакомление с кампусом

---

## 13. КОНФИГУРАЦИЯ И РАЗВЁРТЫВАНИЕ

### 13.1 Текущая конфигурация (Desktop)
- **OS**: Windows 7+
- **Framework**: .NET Framework / .NET Core
- **UI**: Windows Forms
- **Database**: JSON files

### 13.2 Будущая конфигурация (Веб)
- **Backend**: Python (Flask/Django) или Node.js
- **Frontend**: React/Vue/Angular
- **Database**: PostgreSQL/MongoDB
- **Hosting**: Cloud (AWS/Azure/GCP)

### 13.3 Будущая конфигурация (Мобильная)
- **Android**: Python (Kivy/PyQt) или Kotlin
- **iOS**: Swift или Python (Kivy)
- **Local Database**: SQLite
- **Sync**: REST API к backend

---

## 14. ГЛОССАРИЙ

| Термин | Определение |
|--------|-----------|
| **Node** | Точка на карте (помещение, коридор, лестница, лифт) |
| **Edge** | Связь между двумя узлами с весом (расстояние) |
| **Dijkstra** | Алгоритм поиска кратчайшего пути в взвешенном графе |
| **Floor Plan** | Изображение плана этажа (фоновое изображение) |
| **Graph** | Структура данных, состоящая из узлов и рёбер |
| **Route/Path** | Последовательность узлов, составляющих маршрут |
| **Weight** | Расстояние или стоимость движения между узлами |
| **Building Map** | Полная структура здания/кампуса с узлами и рёбрами |

---

## 15. ДОКУМЕНТАЦИЯ И РЕСУРСЫ

### Файлы проекта
- `BuildingMap.cs` - Основная структура карты
- `Dijkstra.cs` - Реализация алгоритма поиска пути
- `Node.cs` - Определение узла
- `Edge.cs` - Определение связи между узлами
- `NavigationForm.cs` - Главный UI компонент
- `RouteTests.cs` - Unit-тесты

### Формат данных
- Формат сохранения: JSON
- Стандартный файл: `map.json`

---

## 16. КРИТЕРИИ ПРИЁМА

Продукт считается готовым когда:
1. ✅ Все основные функции реализованы и тестированы
2. ✅ UI интуитивен и удобен в использовании
3. ✅ Система может обрабатывать до 1000+ узлов без заметной задержки
4. ✅ Маршруты рассчитываются корректно для всех сценариев
5. ✅ Карты корректно сохраняются и загружаются
6. ✅ Code покрыт unit-тестами (>80%)
7. ✅ Документация полная и актуальна

---

**Документ подготовлен для переноса функционала на веб-платформу и мобильные приложения (Python/Android/iOS).**

