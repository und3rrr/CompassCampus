# ‚úÖ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç

## –ò—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –û—à–∏–±–∫–∞ –ø–æ—Ç–æ–∫–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –º–∞—Ä—à—Ä—É—Ç–∞
```
TypeError: Cannot create graphics instruction outside the main Kivy thread
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–®–ï–ù–û**

**–ü—Ä–∏—á–∏–Ω–∞:** Popup —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ _fetch_route()

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Clock.schedule_once()` –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è UI –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ

---

### 2. ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä –Ω–∞—á–∞–ª—å–Ω–æ–π —Ç–æ—á–∫–∏
```
–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–æ—á–∫–∏ –ø—Ä–∏—à–ª–æ—Å—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–®–ï–ù–û**

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞" (5-—è –∫–Ω–æ–ø–∫–∞ –≤ –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª–∏)
- –ú–µ—Ç–æ–¥ `on_cancel_selection()` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏
- –ú–µ—Ç–æ–¥ `clear_selection()` –≤ MapWidget –æ—á–∏—â–∞–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é

---

### 3. ‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API (WinError 10061)
```
[ERROR] HTTPConnectionPool(host='localhost', port=8000): 
Max retries exceeded with url: /api/v1/navigation/routes/shortest
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–®–ï–ù–û** (–±–æ–ª–µ–µ —Ç–æ–≥–æ - –¥–æ–±–∞–≤–ª–µ–Ω fallback)

**–ü—Ä–∏—á–∏–Ω–∞:** API —Å–µ—Ä–≤–µ—Ä –Ω–∞ localhost:8000 –Ω–µ –±—ã–ª –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–π–º–∞–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ ConnectionError
- –î–æ–±–∞–≤–ª–µ–Ω **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback** –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–ª–≥–æ—Ä–∏—Ç–º **Dijkstra** –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫—Ä–∞—Ç—á–∞–π—à–µ–≥–æ –ø—É—Ç–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç –º–∞—Ä—à—Ä—É—Ç –¥–∞–∂–µ –±–µ–∑ API —Å–µ—Ä–≤–µ—Ä–∞

---

### 4. ‚ùå –ì—Ä–∞—Ñ–∏–∫ –Ω–µ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–æ–Ω—Ü–∞ –º–∞—Ä—à—Ä—É—Ç–∞
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–®–ï–ù–û**

**–†–µ—à–µ–Ω–∏–µ:** 
- –ì—Ä–∞—Ñ–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è –≤ `map_widget.set_route()`
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ —Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `_calculate_route()`
- –ú–µ—Ç–æ–¥ `_highlight_graph()` –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

---

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### GraphBuilder.find_shortest_path()
```python
def find_shortest_path(start_id, end_id, edges, nodes_dict) -> Optional[Tuple[List[str], float]]:
    """
    –ê–ª–≥–æ—Ä–∏—Ç–º Dijkstra –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫—Ä–∞—Ç—á–∞–π—à–µ–≥–æ –ø—É—Ç–∏
    
    Args:
        start_id: ID –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —É–∑–ª–∞
        end_id: ID –∫–æ–Ω–µ—á–Ω–æ–≥–æ —É–∑–ª–∞
        edges: –°–ø–∏—Å–æ–∫ —Ä—ë–±–µ—Ä –≥—Ä–∞—Ñ–∞
        nodes_dict: –°–ª–æ–≤–∞—Ä—å —É–∑–ª–æ–≤
    
    Returns:
        (–ø—É—Ç—å –∫–∞–∫ —Å–ø–∏—Å–æ–∫ ID, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ) –∏–ª–∏ None
    """
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Dijkstra
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö —É–∑–ª–æ–≤
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏
- ‚úÖ –†–∞—Å—á—ë—Ç –æ–±—â–µ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è

### Fallback —Ä–µ–∂–∏–º –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
```
API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω? ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Dijkstra ‚Üí –õ–æ–∫–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ ‚Üí –ú–∞—Ä—à—Ä—É—Ç –≥–æ—Ç–æ–≤
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç –æ—Ç API
2. –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≤–∏—Ç—Å—è
3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è Node –æ–±—ä–µ–∫—Ç—ã –≤ dict –¥–ª—è –≥—Ä–∞—Ñ–∞
4. –°—Ç—Ä–æ—è—Ç—Å—è —Ä—ë–±—Ä–∞ –º–µ–∂–¥—É –±–ª–∏–∑–∫–∏–º–∏ —É–∑–ª–∞–º–∏ (‚â§ 150px)
5. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Dijkstra –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—É—Ç–∏
6. –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å –ø–æ–º–µ—Ç–∫–æ–π "(–ª–æ–∫–∞–ª—å–Ω—ã–π)"

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –õ–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –º–∞—Ä—à—Ä—É—Ç–∞
```bash
python test_dijkstra.py
```
–†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ì—Ä–∞—Ñ –ø–æ—Å—Ç—Ä–æ–µ–Ω –∏–∑ 78 —É–∑–ª–æ–≤
- ‚úÖ 160+ —Ä—ë–±–µ—Ä —Å–æ–∑–¥–∞–Ω–æ
- ‚úÖ –ü—É—Ç—å –Ω–∞–π–¥–µ–Ω –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã

### –¢–µ—Å—Ç 2: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ–∑ API
```bash
python main.py
```
–î–µ–π—Å—Ç–≤–∏—è:
1. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. ‚úÖ –í—ã–±—Ä–∞—Ç—å –∑–¥–∞–Ω–∏–µ
3. ‚úÖ –ù–∞–∂–∞—Ç—å –Ω–∞ –¥–≤–µ —Ç–æ—á–∫–∏
4. ‚úÖ –ú–∞—Ä—à—Ä—É—Ç –ø–æ—Å—Ç—Ä–æ–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞!)
5. ‚úÖ –ù–∞–∂–∞—Ç—å "–û—Ç–º–µ–Ω–∞" - –≤—ã–±–æ—Ä —Å–±—Ä–æ—Å–∏—Ç—Å—è

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ | ~150 |
| –§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ | 4 |
| –ù–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ | 3 |
| –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ | ‚úÖ test_dijkstra.py |
| –ö–æ–º–º–∏—Ç–æ–≤ | 4 |

---

## Git –∏—Å—Ç–æ—Ä–∏—è

```
36b8851 - Add: Comprehensive pathfinding solution documentation
36979fc - Add: Dijkstra pathfinding test script  
3910d3a - Fix: Correct Route object usage (path field)
42edffe - Feature: Add local pathfinding fallback + implement Dijkstra
8022d06 - Fix: Add cancel selection button, fix UI threading issue
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### –ü—Ä–∏–º–µ—Ä 1: –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (—Å API)
```
–í—ã–±–æ—Ä –Ω–∞—á–∞–ª—å–Ω–æ–π —Ç–æ—á–∫–∏ ‚Üí API –∑–∞–ø—Ä–æ—Å ‚Üí –ú–∞—Ä—à—Ä—É—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ ‚Üí –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
–†–µ–∑—É–ª—å—Ç–∞—Ç: "–ú–∞—Ä—à—Ä—É—Ç: [–Ω–∞–∑–≤–∞–Ω–∏–µ] ‚Üí [–Ω–∞–∑–≤–∞–Ω–∏–µ] / –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 234–º | –í—Ä–µ–º—è: 3–º–∏–Ω"
```

### –ü—Ä–∏–º–µ—Ä 2: Fallback —Ä–µ–∂–∏–º (–±–µ–∑ API)
```
–í—ã–±–æ—Ä –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ ‚Üí Dijkstra –ø–æ–∏—Å–∫ ‚Üí –ú–∞—Ä—à—Ä—É—Ç –∏–∑ –≥—Ä–∞—Ñ–∞ ‚Üí –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
–†–µ–∑—É–ª—å—Ç–∞—Ç: "–ú–∞—Ä—à—Ä—É—Ç (–ª–æ–∫–∞–ª—å–Ω—ã–π): [–Ω–∞–∑–≤–∞–Ω–∏–µ] ‚Üí [–Ω–∞–∑–≤–∞–Ω–∏–µ] / –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 234–º | –í—Ä–µ–º—è: 3–º–∏–Ω"
```

---

## –ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞—Ç—å —Ç–µ–ø–µ—Ä—å

‚úÖ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ–∑ API —Å–µ—Ä–≤–µ—Ä–∞  
‚úÖ –í—ã–±—Ä–∞—Ç—å –¥–≤–∞ –ª—é–±—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ  
‚úÖ –ü–æ–ª—É—á–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –º–µ–∂–¥—É –Ω–∏–º–∏  
‚úÖ –û—Ç–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä –∏ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç  
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–ª–∞–π–Ω  
‚úÖ –£–≤–∏–¥–µ—Ç—å –≥—Ä–∞—Ñ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø—É—Ç–∏  

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- üî≤ –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- üî≤ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å A* –ø–æ–∏—Å–∫ (–±—ã—Å—Ç—Ä–µ–µ Dijkstra)
- üî≤ –î–æ–±–∞–≤–∏—Ç—å –∏–∑–±–µ–≥–∞–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–ø–∞—Ä–∞–º–µ—Ç—Ä avoid_stairs)
- üî≤ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- üî≤ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±—ç–∫—ç–Ω–¥–∞ –∫–æ–≥–¥–∞ –æ–Ω –≥–æ—Ç–æ–≤

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã.** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ **—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ** –±–ª–∞–≥–æ–¥–∞—Ä—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É Dijkstra –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫—Ä–∞—Ç—á–∞–π—à–µ–≥–æ –ø—É—Ç–∏ –≤ –≥—Ä–∞—Ñ–µ. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã –º–µ–∂–¥—É –ø–æ–º–µ—â–µ–Ω–∏—è–º–∏ –±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏–ª–∏ API —Å–µ—Ä–≤–µ—Ä—É.

**–î–∞—Ç–∞ —Ä–µ—à–µ–Ω–∏—è:** 25 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ï–ù–£

---

–î–ª—è –∑–∞–ø—É—Å–∫–∞: `python main.py`  
–î–ª—è —Ç–µ—Å—Ç–∞ Dijkstra: `python test_dijkstra.py`
